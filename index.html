<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amica: The Clinically-Informed Mental Wellness Companion</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #87CEEB; /* Sky Blue background */
        }
        .section-card {
            border-radius: 1.5rem;
            box-shadow: 0 8px 16px rgba(17, 24, 39, 0.05);
        }
        .chat-container {
            height: 400px; /* Fixed height for chat window */
            overflow-y: auto;
            background-color: #ffffff;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
        }
        .user-message {
            background-color: #a5b4fc; /* Light Indigo */
            color: #1e3a8a; /* Dark Blue */
            max-width: 80%;
        }
        .amica-message {
            background-color: #fce7f3; /* Light Pink */
            color: #831843; /* Dark Pink */
            max-width: 80%;
        }
        /* Style for the subtle sign-in/session indicator */
        .session-indicator {
            background-color: #eff6ff; /* Blue background for session info */
            color: #3b82f6; /* Blue text */
        }
        .demo-mode-indicator {
            background-color: #fef3c7; /* Yellow background for demo warning */
            color: #d97706; /* Dark yellow/orange text */
        }
    </style>

    <style>
a:link {
  color: green;
  background-color: transparent;
  text-decoration: none;
}

a:visited {
  color: indigo;
  background-color: transparent;
  text-decoration: none;
}

a:hover {
  color: red;
  background-color: transparent;
  text-decoration: underline;
}

a:active {
  color: yellow;
  background-color: transparent;
  text-decoration: underline;
}
</style>
        <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        setLogLevel('Debug');

        // --- GLOBAL STATE & FIREBASE INITIALIZATION ---
        window.USER_STATE = {
            chat_history: [] // Stores conversation for Gemini API context
        };
        window.isAuthenticated = false; // Initial authentication status
        window.isDemoMode = false; // Flag for API bypass
        
        // Mandatory global variables provided by the environment
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        let db, auth;
        const isFirebaseConfigured = Object.keys(firebaseConfig).length > 0;

        // Function to toggle UI visibility based on auth state
        const toggleChatVisibility = (isAuth) => {
            const chatSection = document.getElementById('chatbot-section');
            const authButtonsDiv = document.getElementById('auth-buttons');
            const sessionIdElement = document.getElementById('user-session-id');
            const modeIndicator = document.getElementById('mode-indicator');

            // Toggles the visibility of the main personalized section
            if (chatSection) {
                 // The chat section is visible if authenticated OR if running in demo mode
                const shouldShowChat = isAuth || !isFirebaseConfigured;
                chatSection.classList.toggle('hidden', !shouldShowChat);
                window.isAuthenticated = shouldShowChat; // Update global state for chat gatekeeping
            }
            
            // Update auth buttons and session indicator
            authButtonsDiv.innerHTML = ''; // Clear existing buttons

            if (isAuth && isFirebaseConfigured) {
                // AUTHENTICATED MODE
                const userId = auth.currentUser.uid;
                sessionIdElement.textContent = `User ID: ${userId}`;
                sessionIdElement.title = `Full User ID: ${userId}`;
                modeIndicator.textContent = 'Mode: Live';
                modeIndicator.className = 'px-3 py-1 text-xs font-semibold rounded-full session-indicator transition duration-150';
                
                // Sign Out Button
                const signOutButton = document.createElement('button');
                signOutButton.className = 'px-4 py-2 text-sm font-semibold rounded-lg text-red-600 border border-red-600 hover:bg-red-50 transition duration-150';
                signOutButton.textContent = 'Sign Out';
                signOutButton.onclick = async () => {
                    await signOut(auth);
                    window.USER_STATE.chat_history = []; // Clear history on sign out
                };
                authButtonsDiv.appendChild(signOutButton);

            } else if (!isAuth && isFirebaseConfigured) {
                // LOGGED OUT MODE (Firebase configured)
                sessionIdElement.textContent = 'Session: Anonymous';
                sessionIdElement.title = 'You are browsing anonymously.';
                modeIndicator.textContent = 'Mode: Offline';
                modeIndicator.className = 'px-3 py-1 text-xs font-semibold rounded-full bg-gray-200 text-gray-500 transition duration-150';

                // Sign In Button (simulates login)
                const signInButton = document.createElement('button');
                signInButton.className = 'px-4 py-2 text-sm font-semibold rounded-lg text-indigo-600 border border-indigo-600 hover:bg-indigo-50 transition duration-150';
                signInButton.textContent = 'Sign In';
                signInButton.onclick = authenticate; 
                authButtonsDiv.appendChild(signInButton);

                // Sign Up Button (simulates sign up)
                const signUpButton = document.createElement('button');
                signUpButton.className = 'px-4 py-2 text-sm font-semibold rounded-lg bg-indigo-600 text-white hover:bg-indigo-700 transition duration-150 shadow-md';
                signUpButton.textContent = 'Sign Up';
                signUpButton.onclick = authenticate; 
                authButtonsDiv.appendChild(signUpButton);

            } else {
                // DEMO MODE (Firebase NOT configured)
                sessionIdElement.textContent = 'Session: Demo';
                sessionIdElement.title = 'Firebase is not configured. Chat is active but data is not persistent.';
                modeIndicator.textContent = 'Mode: Demo (API Disabled)';
                modeIndicator.className = 'px-3 py-1 text-xs font-semibold rounded-full demo-mode-indicator transition duration-150';
            }
        };

        async function authenticate() {
            if (!isFirebaseConfigured) {
                console.warn("Firebase config not found. Cannot authenticate.");
                return;
            }
            try {
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log("Firebase signed in with custom token.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Firebase signed in anonymously.");
                }
            } catch (error) {
                console.error("Firebase authentication error:", error);
            }
        }
        
        if (isFirebaseConfigured) {
            window.firebaseApp = initializeApp(firebaseConfig);
            db = getFirestore(window.firebaseApp);
            auth = getAuth(window.firebaseApp);
            
            // Listener to handle authentication state changes
            onAuthStateChanged(auth, (user) => {
                const isAuth = !!user;
                toggleChatVisibility(isAuth);
                if (user) {
                    window.currentUserId = user.uid;
                }
            });
            authenticate(); // Initial attempt to sign in on load
        } else {
            console.warn("Firebase configuration not found. Running in DEMO MODE.");
            window.isDemoMode = true;
            // Directly call toggle with false auth state to trigger Demo Mode UI logic
            toggleChatVisibility(false); 
        }

        // --- DEMO MODE RESPONSES ---
        const demoResponses = [
            "I hear the feeling of overwhelm. It sounds heavy. Could you tell me one specific thing that is making you feel this way right now?",
            "That's a valid feeling. Let's take a deep breath together. When we break down big feelings into smaller pieces, they often feel more manageable. What small step can you take today?",
            "It sounds like you are carrying a lot. Remember, your feelings are signals, not facts. What is one supportive thought you could offer yourself right now?",
            "Thank you for sharing that with me. That takes courage. Let's explore that thought a little deeper using the CBT framework. What evidence supports that thought, and what evidence challenges it?",
            "I'm here for you. We can try a quick grounding exercise if that would help. Can you name three things you can see, two things you can hear, and one thing you can touch?"
        ];

        let demoResponseIndex = 0;

        const getDemoResponse = () => {
            const response = demoResponses[demoResponseIndex];
            demoResponseIndex = (demoResponseIndex + 1) % demoResponses.length; // Cycle through responses
            return { response: response, success: true, actionCommand: "DEMO_MODE: Bypassed_API" };
        };


        // --- GEMINI API INTEGRATION (Now includes Demo Mode Fallback) ---
        
        /**
         * Calls the Gemini API to get Amica's response, or uses demo mode if unavailable.
         */
        window.callGeminiApi = async (prompt) => {
            if (window.isDemoMode) {
                return getDemoResponse();
            }

            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;

            // System prompt defining Amica's persona
            const systemPrompt = "You are Amica, a compassionate and non-judgmental mental wellness robot designed on Cognitive Behavioral Therapy (CBT) principles. Your goal is to provide supportive, reflective, and clinically-informed responses. Keep your responses concise, empathetic, and focus on validating the user's feelings while subtly guiding them towards self-awareness and coping skills. DO NOT provide medical advice; always defer to professional help in crisis. Never mention API keys or technical terms.";
            
            // Map our internal chat history format to the API format (model/user roles)
            const chatHistory = window.USER_STATE.chat_history.map(msg => ({
                role: msg.role === 'amica' ? 'model' : 'user',
                parts: [{ text: msg.text }]
            }));
            
            // Add the current user prompt
            chatHistory.push({ role: 'user', parts: [{ text: prompt }] });

            const payload = {
                contents: chatHistory,
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
                tools: [{ "google_search": {} }], 
            };

            const options = {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            };

            try {
                // Use fetch with retry for robust API calls
                const response = await fetchWithRetry(apiUrl, options);
                const result = await response.json();
                
                const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (text) {
                    return { response: text, success: true, actionCommand: "API_Success: Generated_Response" };
                } else {
                    // If the API returns a valid response object but no text (e.g., filtered content)
                    const noTextError = "API response received, but no content generated (potential safety filter).";
                    console.error(noTextError, result);
                    throw new Error(noTextError);
                }
            } catch (error) {
                // If the real API call fails, switch to demo mode for this and future calls
                console.error("API call failed. Falling back to Demo Mode.", error);
                window.isDemoMode = true; // Permanent switch to demo mode for the session
                document.getElementById('mode-indicator').textContent = 'Mode: Demo (API FAILED)';
                document.getElementById('mode-indicator').className = 'px-3 py-1 text-xs font-semibold rounded-full demo-mode-indicator transition duration-150';

                // Return a specific demo response to acknowledge the error and provide a first response
                return { 
                    response: "I seem to be experiencing some technical difficulties connecting to my core intelligence. For now, I can provide supportive, pre-programmed guidance to help you focus on the present moment.", 
                    success: true, 
                    actionCommand: `FALLBACK_TO_DEMO: ${error.message || 'Unknown Network Error'}` 
                };
            }
        };
        
        // --- Remaining Helper Functions ---
        async function fetchWithRetry(url, options, maxRetries = 5, delay = 1000) {
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        // Throw an error on non-2xx response codes
                        const errorBody = await response.text();
                        const errorMsg = `HTTP error! status: ${response.status}`;
                        console.error(errorMsg, errorBody);
                        throw new Error(errorMsg); // Throw the error for window.callGeminiApi to catch
                    }
                    return response;
                } catch (error) {
                    if (i === maxRetries - 1) {
                        console.error("Max retries reached. Failing request.", error);
                        throw error;
                    }
                    // Exponential backoff
                    await new Promise(res => setTimeout(res, delay));
                    delay *= 2; 
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex flex-col items-center">

        <nav class="w-full bg-white shadow-sm sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                                <div class="flex-shrink-0">
                    <span class="text-2xl font-extrabold">
                        <span class="text-indigo-600">Amica</span>
                        <span class="text-pink-500">.ai</span>
                    </span>
                </div>
                                <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                    <a href="#chatbot" class="text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium hover:text-indigo-600 transition">Amica Chatbot</a>
                    <a href="#robot" class="text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium hover:text-indigo-600 transition">Amica Robot</a>
                    <a href="#knowledge" class="text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium hover:text-indigo-600 transition">Knowledge</a>
                    <a href="#team" class="text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium hover:text-indigo-600 transition">Our Team</a>
                    <a href="#chatbot-section" class="text-gray-900 inline-flex items-center px-1 pt-1 text-sm font-medium hover:text-indigo-600 transition">Start Chat</a>
                </div>
                                <div class="flex items-center space-x-4">
                    <div id="mode-indicator" class="px-3 py-1 text-xs font-semibold rounded-full session-indicator transition duration-150">
                        Loading Mode...
                    </div>
                    <div id="user-session-id" class="text-xs font-mono px-3 py-1 rounded-full session-indicator transition duration-150">
                        Loading Session...
                    </div>
                                        <div id="auth-buttons" class="flex items-center space-x-3">
                                                <button class="px-4 py-2 text-sm font-semibold rounded-lg text-indigo-600 border border-indigo-600">Sign In</button>
                        <button class="px-4 py-2 text-sm font-semibold rounded-lg bg-indigo-600 text-white">Sign Up</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

        <div class="w-full max-w-7xl px-4 sm:px-6 lg:px-8 py-12 space-y-20">

                <section id="chatbot" class="section-card bg-white p-10 border border-gray-100 flex flex-col md:flex-row items-center gap-10">
            <div class="md:w-3/5 space-y-6">
                <h2 class="text-5xl font-extrabold text-gray-900 leading-tight">
                    Your **24/7 Mental Health Support** Chatbot 💬
                </h2>
                    
                <p class="text-xl text-gray-600">
                    The **Amica Chatbot** provides immediate, empathetic mental health support grounded in **Cognitive Behavioral Therapy (CBT)** principles. It's designed to be a non-judgmental listener, offering reflective questioning and coping skills right when you need them. Start a private session anytime—it's free and always ready.
                </p>
                
                <div class="py-4">
                    <a href="https://amicarobot-mwq6taxcz847ppunwsotpb.streamlit.app/" target="_blank" class="px-8 py-4 bg-pink-600 text-white text-xl font-bold rounded-full hover:bg-pink-700 transition duration-300 shadow-lg">
                        Launch Free Amica Chatbot Session!
                    </a>
                </div>
                
                <ul class="space-y-2 text-gray-700">
                    <li class="flex items-center"><span class="text-green-500 mr-3 text-xl">&#10003;</span>Clinically-informed CBT techniques in every dialogue.</li>
                    <li class="flex items-center"><span class="text-green-500 mr-3 text-xl">&#10003;</span>24/7, non-judgmental, immediate support via web.</li>
                </ul>
            </div>
            <div class="md:w-2/5 flex justify-center">
                                <div class="p-8 bg-indigo-100 rounded-2xl shadow-xl overflow-hidden">
                    <img src="assets/chatbot-screen.jpg" 
                         onerror="this.onerror=null; this.src='https://placehold.co/240x240/a5b4fc/1e3a8a?text=Amica+Chatbot+Screen'"
                         alt="Amica Chatbot Interface Preview" 
                         class="h-60 w-60 object-cover rounded-lg border-2 border-indigo-400">
                </div>
            </div>
        </section>
        
                <section id="robot" class="section-card bg-white p-10 border border-gray-100 flex flex-col-reverse md:flex-row items-center gap-10">
            <div class="md:w-2/5 flex justify-center">
                                <div class="p-8 bg-pink-100 rounded-full shadow-xl overflow-hidden">
                    <img src="assets/robot.jpg" 
                         onerror="this.onerror=null; this.src='https://placehold.co/192x192/fce7f3/db2777?text=Amica+Robot+Arduino'"
                         alt="Amica Robot Illustration" 
                         class="h-60 w-60 object-cover rounded-full">
                </div>
            </div>
            <div class="md:w-3/5 space-y-6">
                <h2 class="text-5xl font-extrabold text-gray-900 leading-tight">
                    The **Amica Robot** Companion 🤖
                </h2>
                    
                <p class="text-xl text-gray-600">
                    **Amica Robot** is a physical, interactive mental health companion built on an **Arduino platform**. It combines the chatbot's advanced AI empathy with tangible interaction, providing a comforting, physical presence. Its design makes it an ideal companion for **kids**, **adults**, and **elderly** individuals who benefit from non-verbal cues and a dedicated, responsive device.
                </p>
                
                <ul class="space-y-2 text-gray-700">
                    <li class="flex items-center"><span class="text-green-500 mr-3 text-xl">&#10003;</span>Physical, comforting presence for all ages.</li>
                    <li class="flex items-center"><span class="text-green-500 mr-3 text-xl">&#10003;</span>Arduino-based for custom hardware interactions.</li>
                    <li class="flex items-center"><span class="text-green-500 mr-3 text-xl">&#10003;</span>Suitable for children and adults needing physical reassurance.</li>
                </ul>
            </div>
        </section>

                <section id="knowledge" class="space-y-10">
            <h2 class="text-4xl font-bold text-center text-gray-800">Knowledge-Driven Care</h2>
            <p class="text-center text-lg text-gray-600 max-w-3xl mx-auto">Amica's responses are grounded in accredited therapeutic practices, ensuring a safe and beneficial supportive experience.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="section-card p-6 bg-green-50 border border-green-200 hover:shadow-lg transition">
                    <h3 class="font-bold text-2xl text-green-700 mb-3">Structured Skill Building</h3>
                    <p class="text-base text-gray-600 leading-relaxed">Amica guides you through **identifying and challenging unhelpful thoughts** using proven Cognitive Behavioral Therapy frameworks.</p>
                </div>
                <div class="section-card p-6 bg-blue-50 border border-blue-200 hover:shadow-lg transition">
                    <h3 class="font-bold text-2xl text-blue-700 mb-3">Immediate Emotional Regulation</h3>
                    <p class="text-base text-gray-600 leading-relaxed">It facilitates in-the-moment calming exercises like **mindful breathing and sensory grounding** for managing acute anxiety.</p>
                </div>
                <div class="section-card p-6 bg-pink-50 border border-pink-200 hover:shadow-lg transition">
                    <h3 class="font-bold text-2xl text-pink-700 mb-3">Ethical and Empathetic Design</h3>
                    <p class="text-base text-gray-600 leading-relaxed">Safety is paramount. Amica's core logic includes **crisis detection filters** and always prioritizes non-judgmental, empathetic validation.</p>
                </div>
            </div>
        </section>

                <section id="chatbot-section" class="space-y-10 hidden">
            <h2 class="text-4xl font-bold text-center text-gray-800">Start Your Personal Journey with Amica</h2>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                                <div class="lg:col-span-2 section-card bg-white p-6 border border-gray-100">
                    <h3 class="text-2xl font-semibold text-indigo-600 mb-4">Your Private Chat Session</h3>
                    <div id="chat-window" class="chat-container mb-4 p-4 space-y-4">
                                                <div class="flex justify-start">
                            <div class="amica-message p-3 rounded-xl rounded-tl-none shadow">
                                Welcome! I'm Amica, your mental wellness companion. How can I support you on your journey today? (Try something like, "I'm feeling overwhelmed.")
                            </div>
                        </div>
                    </div>
                    
                                        <div class="flex space-x-3">
                        <input id="chat-input" type="text" placeholder="Type your message here... (e.g., 'I feel anxious today' or 'How do I start mindfulness?')" class="flex-grow p-3 border border-gray-300 rounded-xl focus:ring-indigo-500 focus:border-indigo-500 shadow-sm" />
                        <button id="chat-send-button" class="px-6 py-3 bg-indigo-600 text-white font-semibold rounded-xl hover:bg-indigo-700 transition duration-150 shadow-md">
                            Send
                        </button>
                    </div>
                </div>

                                <div class="lg:col-span-1 section-card bg-gray-800 p-6 border border-gray-700">
                    <h3 class="text-2xl font-bold text-white mb-4 border-b border-indigo-400 pb-2">Personal Journey Status</h3>
                    <p class="text-gray-400 text-sm mb-4">
                        This panel reflects the live communication between your browser and Amica's Core Intelligence Module (CIM).
                    </p>
                    
                    <div class="mb-4">
                        <h4 class="text-lg font-semibold text-pink-400 mb-1">Amica's Dialogue Output</h4>
                        <div id="cim-dialogue-output" class="p-3 bg-gray-900 rounded-lg text-white font-medium text-sm italic min-h-[50px]">
                            Awaiting your first message...
                        </div>
                    </div>

                    <div>
                        <h4 class="text-lg font-semibold text-purple-400 mb-1">API Status & Action Command</h4>
                        <div id="cim-action-output" class="p-3 bg-gray-900 rounded-lg text-green-400 font-mono text-xs min-h-[50px] overflow-auto">
                            Idle: Ready_For_User_Input
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
                <section id="team" class="space-y-10 py-12">
            <h2 class="text-4xl font-bold text-center text-gray-800">Meet the Core Team</h2>
            <p class="text-center text-lg text-gray-600 max-w-3xl mx-auto">Amica was founded by a blend of clinical expertise and advanced AI engineering to ensure safety and effectiveness.</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div class="section-card bg-white p-6 border border-gray-100 text-center">
                    <div class="mx-auto h-60 w-60 bg-indigo-100 rounded-full flex items-center justify-center mb-4 overflow-hidden">
                                                <img src="assets/Anurag.jpg" 
                             onerror="this.onerror=null; this.src='https://placehold.co/128x128/e0e7ff/4338ca?text=Anurag'"
                             alt="Profile photo of Anurag Batham" 
                             class="h-full w-full object-cover rounded-full">
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800"> Anurag Batham, B.Tech CSE</h3>
                    <p class="text-indigo-600 font-medium mb-3">Hardware & Systems Engineer</p>
                    <p class="text-gray-600">Anurag is a B.Tech CSE student specializing in embedded systems, IoT, and robotics. He is driven by a vision to create emotionally intelligent machines that can interact naturally with humans. At the project’s core, Anurag integrates hardware components — from microphones to servo motors — with real-time AI systems to bring the mental health support robot to life. His goal is to bridge the gap between AI empathy and physical interaction.</p>
                </div>
                
                                <div class="section-card bg-white p-6 border border-gray-100 text-center">
                    <div class="mx-auto h-60 w-60 bg-pink-100 rounded-full flex items-center justify-center mb-4 overflow-hidden">
                                                <img src="assets/Hnin.jpg" 
                             onerror="this.onerror=null; this.src='https://placehold.co/128x128/fce7f3/db2777?text=Hnin'"
                             alt="Profile photo of Hnin Lae Khaing" 
                             class="h-full w-full object-cover rounded-full">
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800">Hnin Lae Khaing, B.Tech CSE</h3>
                    <p class="text-pink-600 font-medium mb-3">AI & Frontend Lead</p>
                    <p class="text-gray-600">Hnin is a passionate B.Tech Computer Science student with a strong interest in artificial intelligence, human-computer interaction, and emotional well-being technology. She focuses on building empathetic AI models and user-friendly interfaces that make mental health support more accessible. As the AI and frontend lead, Hnin ensures the robot communicates with warmth and understanding, blending psychology and technology for real impact.</p>
                </div>
            </div>
        </section>
        
    </div>

        <footer class="w-full bg-gray-900 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center text-gray-400">
            <p>&copy; 2025 Amica.ai. Clinically Informed. Ethically Designed.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatInput = document.getElementById('chat-input');
            const sendButton = document.getElementById('chat-send-button');
            const chatWindow = document.getElementById('chat-window');
            const cimDialogueOutput = document.getElementById('cim-dialogue-output');
            const cimActionOutput = document.getElementById('cim-action-output');

            const appendMessage = (role, text) => {
                const isAmica = role === 'amica';
                const messageContainer = document.createElement('div');
                messageContainer.className = `flex ${isAmica ? 'justify-start' : 'justify-end'}`;
                
                const messageBubble = document.createElement('div');
                messageBubble.className = `p-3 rounded-xl shadow mt-2 ${isAmica ? 'amica-message rounded-tl-none' : 'user-message rounded-br-none'}`;
                // Use innerHTML to allow basic markdown formatting from Gemini
                messageBubble.innerHTML = text; 
                
                messageContainer.appendChild(messageBubble);
                chatWindow.appendChild(messageContainer);
                
                // Scroll to the bottom
                chatWindow.scrollTop = chatWindow.scrollHeight;
            };

            const processPrompt = async () => {
                const prompt = chatInput.value.trim();
                if (!prompt) return;

                // 1. UI Update (User Message)
                appendMessage('user', prompt);
                chatInput.value = ''; 
                
                sendButton.disabled = true;
                sendButton.textContent = 'Processing...';
                cimDialogueOutput.textContent = 'CIM is communicating with Amica\'s core intelligence...';
                cimActionOutput.textContent = 'Running API call...';

                try {
                    // 2. Call the Gemini API or Demo Fallback
                    const { response, actionCommand } = await window.callGeminiApi(prompt);
                    
                    // 3. Update History
                    window.USER_STATE.chat_history.push({ role: 'user', text: prompt });
                    window.USER_STATE.chat_history.push({ role: 'amica', text: response });
                    
                    // 4. UI Update (Amica Response)
                    appendMessage('amica', response);
                    cimDialogueOutput.innerHTML = `**Amica:** ${response.substring(0, 100)}...`;
                    cimActionOutput.textContent = actionCommand;

                } catch (error) {
                    console.error("Chat processing failed and fallback failed (should not happen):", error);
                    
                    // Fallback for a c
